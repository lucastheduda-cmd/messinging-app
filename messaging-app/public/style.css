/* ── CSS Variables ─────────────────────────────────────────────────────────── */
:root {
  --bg-primary:    #36393f;
  --bg-secondary:  #2f3136;
  --bg-tertiary:   #202225;
  --bg-input:      #40444b;
  --bg-message:    #32353b;
  --accent:        #7289da;
  --accent-hover:  #677bc4;
  --text-primary:  #dcddde;
  --text-secondary:#96989d;
  --text-muted:    #72767d;
  --online:        #43b581;
  --offline:       #747f8d;
  --error:         #f04747;
  --border:        #40444b;
  --sidebar-width: 240px;
}

/* ── Reset ─────────────────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  height: 100dvh;
  overflow: hidden;
}

/* ── Auth page ─────────────────────────────────────────────────────────────── */
.auth-page {
  display: flex; align-items: center; justify-content: center;
  background: var(--bg-tertiary); overflow: auto;
}
.auth-card {
  background: var(--bg-secondary); border-radius: 12px; padding: 2rem;
  width: 100%; max-width: 420px; margin: 1rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.auth-logo { text-align: center; font-size: 2rem; margin-bottom: 0.25rem; }
.auth-subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem; }
.auth-tabs { display: flex; background: var(--bg-tertiary); border-radius: 8px; padding: 4px; margin-bottom: 1.5rem; gap: 4px; }
.tab-btn { flex: 1; padding: 0.5rem; border: none; border-radius: 6px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
.tab-btn.active { background: var(--accent); color: white; }
.auth-form { display: flex; flex-direction: column; gap: 1rem; }
.auth-form.hidden { display: none; }
.form-group { display: flex; flex-direction: column; gap: 0.4rem; }
.form-group label { font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
.form-group small { font-size: 0.75rem; color: var(--text-muted); }
input[type="text"], input[type="password"] {
  background: var(--bg-input); border: 1.5px solid var(--border); border-radius: 6px;
  padding: 0.6rem 0.8rem; color: var(--text-primary); font-size: 1rem;
  outline: none; transition: border-color 0.2s;
}
input:focus { border-color: var(--accent); }
input::placeholder { color: var(--text-muted); }
.btn-primary {
  background: var(--accent); color: white; border: none; border-radius: 6px;
  padding: 0.75rem; font-size: 1rem; font-weight: 600; cursor: pointer;
  transition: background 0.2s; margin-top: 0.5rem;
}
.btn-primary:hover { background: var(--accent-hover); }
.btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
.auth-error { color: var(--error); font-size: 0.85rem; min-height: 1.2em; }

/* ── Chat layout ───────────────────────────────────────────────────────────── */
.chat-page { overflow: hidden; }
.chat-layout { display: grid; grid-template-columns: var(--sidebar-width) 1fr; height: 100dvh; }

/* ── Sidebar ───────────────────────────────────────────────────────────────── */
.sidebar { background: var(--bg-secondary); display: flex; flex-direction: column; overflow: hidden; border-right: 1px solid var(--border); }
.sidebar-header { padding: 1rem; border-bottom: 1px solid var(--border); font-weight: 700; }
.sidebar-section { padding: 1rem 0.5rem 0.5rem; overflow-y: auto; }
.sidebar-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); padding: 0 0.5rem; margin-bottom: 0.4rem; }
.room-btn, .dm-btn {
  display: flex; align-items: center; gap: 0.5rem;
  width: 100%; padding: 0.4rem 0.5rem; border: none; border-radius: 4px;
  background: transparent; color: var(--text-secondary); font-size: 0.95rem;
  cursor: pointer; text-align: left; transition: background 0.15s, color 0.15s; position: relative;
}
.room-btn:hover, .dm-btn:hover { background: var(--bg-message); color: var(--text-primary); }
.room-btn.active, .dm-btn.active { background: var(--bg-primary); color: white; }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--offline); flex-shrink: 0; }
.status-dot.online { background: var(--online); }
.unread-badge { margin-left: auto; background: var(--error); color: white; border-radius: 10px; font-size: 0.7rem; font-weight: 700; min-width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
.admin-crown { font-size: 0.8rem; margin-left: 2px; }
.ban-btn { margin-left: auto; background: transparent; border: none; color: var(--text-muted); font-size: 0.85rem; cursor: pointer; padding: 0 4px; border-radius: 4px; transition: color 0.15s; flex-shrink: 0; }
.ban-btn:hover { color: var(--error); }
.ban-btn.banned { color: var(--online); }
.dm-btn.is-banned > span { text-decoration: line-through; opacity: 0.5; }
.sidebar-footer { margin-top: auto; padding: 0.75rem; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 0.5rem; background: var(--bg-tertiary); }
.sidebar-user { display: flex; align-items: center; gap: 0.5rem; flex: 1; overflow: hidden; }
.avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; color: white; flex-shrink: 0; overflow: hidden; }
.avatar img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
#my-username { font-size: 0.9rem; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.logout-btn { background: transparent; border: none; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; padding: 0.25rem; border-radius: 4px; transition: color 0.2s; }
.logout-btn:hover { color: var(--error); }

/* ── Chat header ───────────────────────────────────────────────────────────── */
.chat-main { display: flex; flex-direction: column; height: 100dvh; overflow: hidden; }
.chat-header { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-bottom: 1px solid var(--border); background: var(--bg-primary); flex-shrink: 0; }
.chat-title { font-weight: 700; font-size: 1rem; flex: 1; }
.hamburger { display: none; background: transparent; border: none; color: var(--text-primary); font-size: 1.2rem; cursor: pointer; padding: 0.25rem; }
.header-actions { display: flex; align-items: center; gap: 0.4rem; }
.header-btn { background: transparent; border: none; color: var(--text-muted); font-size: 1.1rem; cursor: pointer; padding: 0.25rem 0.4rem; border-radius: 4px; transition: color 0.15s; }
.header-btn:hover { color: var(--text-primary); }
.header-btn.muted { opacity: 0.4; }
.clear-btn { background: transparent; border: 1px solid var(--error); color: var(--error); border-radius: 6px; padding: 0.3rem 0.6rem; font-size: 0.8rem; cursor: pointer; transition: background 0.2s; }
.clear-btn:hover { background: var(--error); color: white; }

/* ── Search bar ────────────────────────────────────────────────────────────── */
.search-bar { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border); flex-shrink: 0; }
.search-bar input { flex: 1; background: var(--bg-input); border: none; border-radius: 6px; padding: 0.5rem 0.75rem; color: var(--text-primary); font-size: 0.9rem; outline: none; }
.search-bar button { background: transparent; border: none; color: var(--text-muted); font-size: 1rem; cursor: pointer; }

/* ── Messages area ─────────────────────────────────────────────────────────── */
.messages-area { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.15rem; scroll-behavior: smooth; }
.messages-placeholder { color: var(--text-muted); text-align: center; margin: auto; font-size: 0.9rem; }
.message { display: flex; flex-direction: column; padding: 0.3rem 0.5rem; border-radius: 6px; max-width: 75%; position: relative; }
.message:hover { background: var(--bg-message); }
.message:hover .message-actions { opacity: 1; }
.message.mine { align-self: flex-end; align-items: flex-end; }
.message.theirs { align-self: flex-start; align-items: flex-start; flex-direction: row; gap: 0.5rem; }
.message.search-hidden { display: none; }

/* Avatar next to messages */
.message-avatar { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; color: white; flex-shrink: 0; align-self: flex-end; overflow: hidden; }
.message-avatar img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }

.message-content { display: flex; flex-direction: column; }
.message.mine .message-content { align-items: flex-end; }
.message-header { display: flex; align-items: baseline; gap: 0.5rem; margin-bottom: 0.2rem; }
.message-username { font-size: 0.8rem; font-weight: 700; color: var(--accent); }
.message.mine .message-username { color: #43b581; }
.message-time { font-size: 0.7rem; color: var(--text-muted); }
.edited-label { font-size: 0.65rem; color: var(--text-muted); font-style: italic; }

/* Message bubble */
.message-bubble { background: var(--bg-input); padding: 0.5rem 0.75rem; border-radius: 12px; font-size: 0.95rem; line-height: 1.4; word-break: break-word; max-width: 100%; }
.message.mine .message-bubble { background: var(--accent); color: white; border-bottom-right-radius: 4px; }
.message.theirs .message-bubble { border-bottom-left-radius: 4px; }

/* Edit mode */
.edit-input { background: var(--bg-input); border: 1.5px solid var(--accent); border-radius: 8px; padding: 0.5rem 0.75rem; color: var(--text-primary); font-size: 0.95rem; width: 100%; min-width: 200px; outline: none; }

/* Image in a message */
.message-image { max-width: 300px; max-height: 300px; border-radius: 8px; cursor: pointer; display: block; margin-top: 0.25rem; }
.message-image:hover { opacity: 0.9; }

/* Message action buttons (edit/delete/react) — appear on hover */
.message-actions { position: absolute; top: -16px; right: 4px; display: flex; gap: 2px; opacity: 0; transition: opacity 0.15s; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 2px; z-index: 10; }
.message.theirs .message-actions { right: auto; left: 4px; }
.action-btn { background: transparent; border: none; font-size: 0.85rem; cursor: pointer; padding: 2px 5px; border-radius: 4px; color: var(--text-secondary); transition: background 0.15s; }
.action-btn:hover { background: var(--bg-input); color: var(--text-primary); }

/* Reactions bar */
.reactions-bar { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
.reaction-pill { display: flex; align-items: center; gap: 3px; background: var(--bg-input); border: 1.5px solid transparent; border-radius: 12px; padding: 2px 8px; font-size: 0.8rem; cursor: pointer; transition: background 0.15s; }
.reaction-pill:hover { background: var(--border); }
.reaction-pill.mine { border-color: var(--accent); background: rgba(114,137,218,0.15); }

/* Reaction picker popup */
.reaction-picker { position: fixed; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 10px; padding: 6px 8px; display: flex; gap: 4px; z-index: 50; box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
.reaction-picker button { background: transparent; border: none; font-size: 1.3rem; cursor: pointer; padding: 4px; border-radius: 6px; transition: background 0.15s; }
.reaction-picker button:hover { background: var(--bg-input); }

/* Day divider */
.day-divider { display: flex; align-items: center; gap: 0.75rem; color: var(--text-muted); font-size: 0.75rem; margin: 0.75rem 0; align-self: stretch; }
.day-divider::before, .day-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* ── Image preview (before sending) ───────────────────────────────────────── */
.image-preview-area { position: relative; padding: 0.5rem 1rem; border-top: 1px solid var(--border); background: var(--bg-secondary); flex-shrink: 0; display: flex; align-items: center; gap: 0.5rem; }
.image-preview-area img { max-height: 100px; max-width: 200px; border-radius: 6px; }
.remove-image-btn { background: var(--error); color: white; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 0.7rem; cursor: pointer; flex-shrink: 0; }

/* ── Message input area ────────────────────────────────────────────────────── */
.message-input-area { display: flex; gap: 0.5rem; padding: 0.75rem 1rem; border-top: 1px solid var(--border); background: var(--bg-primary); flex-shrink: 0; align-items: center; }
.message-input-area input { flex: 1; background: var(--bg-input); border: none; border-radius: 8px; padding: 0.65rem 0.9rem; color: var(--text-primary); font-size: 0.95rem; outline: none; }
.message-input-area input::placeholder { color: var(--text-muted); }
.attach-btn { font-size: 1.2rem; cursor: pointer; padding: 0 0.25rem; color: var(--text-muted); transition: color 0.15s; }
.attach-btn:hover { color: var(--text-primary); }
.send-btn { background: var(--accent); color: white; border: none; border-radius: 8px; padding: 0 1.2rem; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: background 0.2s; height: 38px; }
.send-btn:hover { background: var(--accent-hover); }

/* ── Avatar modal ──────────────────────────────────────────────────────────── */
.modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; }
.modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; z-index: 201; width: 90%; max-width: 420px; box-shadow: 0 8px 32px rgba(0,0,0,0.5); max-height: 90dvh; overflow-y: auto; }
.modal-title { font-size: 1.1rem; margin-bottom: 1rem; text-align: center; }
.modal-label { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-secondary); margin: 1rem 0 0.5rem; }
.modal-sublabel { font-weight: 400; text-transform: none; letter-spacing: 0; color: var(--text-muted); }
.avatar-preview-wrap { display: flex; justify-content: center; margin-bottom: 0.5rem; }
.avatar-preview { width: 64px; height: 64px; font-size: 1.8rem; pointer-events: none; }
.pfp-section { display: flex; gap: 0.5rem; align-items: center; }
.pfp-upload-btn { background: var(--bg-input); color: var(--text-primary); border: none; border-radius: 6px; padding: 0.5rem 0.8rem; font-size: 0.85rem; cursor: pointer; }
.pfp-upload-btn:hover { background: var(--border); }
.color-grid { display: flex; flex-wrap: wrap; gap: 0.5rem; }
.color-swatch { width: 32px; height: 32px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: transform 0.15s, border-color 0.15s; }
.color-swatch:hover { transform: scale(1.15); }
.color-swatch.selected { border-color: white; transform: scale(1.15); }
.emoji-grid { display: flex; flex-wrap: wrap; gap: 0.4rem; }
.emoji-btn { width: 36px; height: 36px; border-radius: 6px; border: 2px solid transparent; background: var(--bg-input); font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.15s; }
.emoji-btn:hover { background: var(--border); }
.emoji-btn.selected { border-color: var(--accent); }
.modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1.25rem; }
.btn-secondary { background: var(--bg-input); color: var(--text-primary); border: none; border-radius: 6px; padding: 0.6rem 1rem; font-size: 0.9rem; cursor: pointer; }
.btn-secondary:hover { background: var(--border); }

/* ── Mobile ────────────────────────────────────────────────────────────────── */
@media (max-width: 700px) {
  .chat-layout { grid-template-columns: 1fr; }
  .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width); z-index: 100; transform: translateX(-100%); transition: transform 0.25s ease; }
  .sidebar.open { transform: translateX(0); }
  .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99; }
  .sidebar-overlay.visible { display: block; }
  .hamburger { display: block; }
  .message { max-width: 90%; }
  .message-image { max-width: 200px; }
}

/* ── Utility ───────────────────────────────────────────────────────────────── */
.hidden { display: none !important; }
